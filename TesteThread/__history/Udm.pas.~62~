unit Udm;

interface

uses
  SysUtils, Classes, IdMessage, IdAntiFreezeBase, IdAntiFreeze, IdBaseComponent,
  IdComponent, IdTCPConnection, IdTCPClient, IdExplicitTLSClientServerBase,
  IdMessageClient, IdPOP3, DB, MemDS, DBAccess, MyAccess,
  IdSchedulerOfThreadDefault, IdScheduler, IdSchedulerOfThread,
  IdSchedulerOfThreadPool, IdThreadComponent, Wwdatsrc,


   DBClient, funcoes,  Graphics, Controls, Forms, Dialogs, StdCtrls, ADODB,
  IdIntercept, IdLogBase, IdLogEvent, DAScript, MyScript, IdIOHandler,
  IdIOHandlerSocket, IdIOHandlerStack;



type
  TDM = class(TDataModule)
    MC: TMyConnection;
    POP: TIdPOP3;
    IdAntiFreeze1: TIdAntiFreeze;
    MSG: TIdMessage;
    IDT: TIdThreadComponent;
    IdPool: TIdSchedulerOfThreadPool;
    DataSource1: TDataSource;
    TmemX: TMyQuery;
    TmemXID: TLargeintField;
    TmemXDT: TDateTimeField;
    TmemXEmail: TWideStringField;
    TmemXAssunto: TWideStringField;
    TmemXEmitente: TWideStringField;
    TmemXTama: TIntegerField;
    TmemXDatamens: TDateTimeField;
    TmemXCabec: TWideMemoField;
    TmemXCorpo: TWideMemoField;
    TmemXStatus: TIntegerField;
    TmemXFiltrada: TIntegerField;
    TmemXListaNegra: TIntegerField;
    TmemXFavoritos: TIntegerField;
    TmemXFiltroResult: TWideMemoField;
    TmemXListaNegraResult: TWideMemoField;
    TmemXNumeroMens: TIntegerField;
    TmemXExcluida: TIntegerField;
    TmemXAnexos: TIntegerField;
    TmemXselecionada: TIntegerField;
    TmemXConta: TWideStringField;
    TmemXMsgId: TWideStringField;
    TmemXIsBodyEmpty: TBooleanField;
    TmemXUID: TWideStringField;
    TmemXIsMsgSinglePartMime: TBooleanField;
    TmemXAttachmentEncoding: TWideStringField;
    TmemXCharSet: TWideStringField;
    TmemXContentType: TWideStringField;
    TmemXContentTransferEncoding: TWideStringField;
    TmemXContentDisposition: TWideStringField;
    TmemXNoEncode: TBooleanField;
    TmemXNoDecode: TBooleanField;
    TmemXOrganization: TWideStringField;
    TmemXDataOrig: TWideStringField;
    TmemXXmailer: TWideStringField;
    TmemXReplayTO: TWideStringField;
    TmemXReturnPath: TWideStringField;
    TmemXFromOrig: TWideStringField;
    TmemXToOrig: TWideStringField;
    TmemXCCOrig: TWideMemoField;
    TmemXBCCOrig: TWideMemoField;
    TmemXReceivedFrom: TWideStringField;
    TmemXFriendResult: TWideMemoField;
    TmemXEmailFrom: TWideStringField;
    TmemXDominioFrom: TWideStringField;
    TmemXIPSender: TWideStringField;
    TmemXID_Conta: TIntegerField;
    TmemXAnexosFiles: TWideMemoField;
    TmemXCountry: TWideStringField;
    TmemXlida: TIntegerField;
    qdns: TMyQuery;
    qdnsactive: TIntegerField;
    qdnsName: TWideStringField;
    qdnsdns: TWideStringField;
    qdnsID: TIntegerField;
    ds_Qdns: TDataSource;
    qVePais: TMyQuery;
    qVePaissigla: TWideStringField;
    qVePaisPAIS: TWideStringField;
    qVePaisID: TIntegerField;
    qVePaisIPNUMFROM: TLargeintField;
    qVePaisIPNUMTO: TLargeintField;
    IdLogEvent1: TIdLogEvent;
    MyScript1: TMyScript;
    IdIOHandlerStack1: TIdIOHandlerStack;
    Tmem: TClientDataSet;
    ClientDataSet2: TClientDataSet;
    ClientDataSet3: TClientDataSet;
    TmemID: TAutoIncField;
    TmemDT: TDateTimeField;
    TmemEmail: TWideStringField;
    TmemAssunto: TWideStringField;
    TmemEmitente: TWideStringField;
    TmemTama: TIntegerField;
    TmemDatamens: TWideStringField;
    TmemCabec: TWideMemoField;
    TmemCorpo: TWideMemoField;
    TmemStatus: TIntegerField;
    TmemFiltrada: TIntegerField;
    TmemListaNegra: TIntegerField;
    TmemFavoritos: TIntegerField;
    TmemFiltroResult: TWideMemoField;
    TmemListaNegraResult: TWideMemoField;
    TmemNumeroMens: TIntegerField;
    TmemExcluida: TIntegerField;
    TmemAnexos: TIntegerField;
    Tmemselecionada: TIntegerField;
    TmemConta: TWideStringField;
    TmemMsgId: TWideStringField;
    TmemIsBodyEmpty: TBooleanField;
    TmemUID: TWideStringField;
    TmemIsMsgSinglePartMime: TBooleanField;
    TmemAttachmentEncoding: TWideStringField;
    TmemCharSet: TWideStringField;
    TmemContentType: TWideStringField;
    TmemContentTransferEncoding: TWideStringField;
    TmemContentDisposition: TWideStringField;
    TmemNoEncode: TBooleanField;
    TmemNoDecode: TBooleanField;
    TmemOrganization: TWideStringField;
    TmemDataOrig: TWideStringField;
    TmemXmailer: TWideStringField;
    TmemReplayTO: TWideStringField;
    TmemReturnPath: TWideStringField;
    TmemFromOrig: TWideStringField;
    TmemToOrig: TWideMemoField;
    TmemCCOrig: TWideMemoField;
    TmemBCCOrig: TWideMemoField;
    TmemReceivedFrom: TWideStringField;
    TmemFriendResult: TWideMemoField;
    TmemEmailFrom: TWideStringField;
    TmemDominioFrom: TWideStringField;
    TmemIPSender: TWideStringField;
    TmemID_Conta: TIntegerField;
    TmemAnexosFiles: TWideMemoField;
    TmemCountry: TWideStringField;
    Tmemlida: TIntegerField;
    TmemCorpoTexto: TWideMemoField;
    TmemMSG_REF: TIntegerField;
    procedure DataModuleCreate(Sender: TObject);

  private

    { Private declarations }
  public
    { Public declarations }
    function VePais(NUME: Cardinal): string;
  end;

var
  DM: TDM;

implementation

{$R *.dfm}




procedure TDM.DataModuleCreate(Sender: TObject);
var
  dire:string;
begin
  tmem.FileName:= dire+'Dados\messages.cds';
end;

Function TDM.VePais(NUME:Cardinal):string;
var
  query : Tmyquery;
begin



  qVePais.Filter := 'pais.IPNUMFROM <= '+inttostr(NUME)+' and pais.IPNUMTO >= '+inttostr(NUME);
  qVePais.Filtered := true;
  if qVePais.recordcount > 0 then
     result := qVePais.FieldByName('PAIS').AsString+'_.'+qVePais.FieldByName('sigla').AsString
     else
     result := 'Não achou '+inttostr(NUME);


end;

end.
